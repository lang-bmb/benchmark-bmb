# BMB Benchmark Results - Phase 34.4 (v0.34)

> Date: 2026-01-09
> BMB Version: v0.34 (Stage 3 100%, f64 + Scientific Notation)
> Rust Version: 1.8x (LLVM backend)
> System: Windows 11, single run

## Executive Summary

| Category | Benchmarks | Status |
|----------|------------|--------|
| Compute-Intensive | 3/3 valid | âœ… BMB >= Rust |
| Contract-Optimized | 1/1 valid | âš ï¸ Parity |
| Real-World | 1/1 valid | âŒ 2.5x slower |
| f64 Support | New in v0.34 | âœ… Working |

**v0.34 Achievements**:
- Stage 3 Bootstrap: 100% (7/7 tests passing)
- f64 Type: Complete with scientific notation
- Scientific notation: `6.022e23`, `1e-5`, `1.5E10` supported

---

## Detailed Results

### Category A: Compute-Intensive

| Benchmark | Rust (ms) | BMB (ms) | Ratio | Status |
|-----------|-----------|----------|-------|--------|
| fibonacci(35) | 80 | 74 | **0.93x** | âœ… BMB 7% faster |
| mandelbrot (fixed-point) | 42 | 39 | **0.93x** | âœ… BMB 7% faster |
| spectral_norm | 44 | 39 | **0.89x** | âœ… BMB 11% faster |
| binary_trees | - | - | N/A | âš ï¸ Requires heap allocation |
| fannkuch | - | - | N/A | âš ï¸ Implementation mismatch |
| n_body | - | - | N/A | âš ï¸ Requires sqrt intrinsic |

**v0.34 Notes:**
- All compute-intensive benchmarks show BMB competitive or faster than Rust
- `n_body` is unblocked by f64 but still needs `sqrt` intrinsic (stdlib/math)
- `binary_trees` blocked by Phase 34.2 (Dynamic Collections)

### Category B: Contract-Optimized

| Benchmark | Rust (ms) | BMB (ms) | Ratio | Status |
|-----------|-----------|----------|-------|--------|
| purity_opt | 101 | 102 | **1.01x** | âš ï¸ Parity (expected better) |
| bounds_check | - | - | N/A | âš ï¸ Incomplete implementation |
| null_check | - | - | N/A | ğŸ“‹ Not tested |
| aliasing | - | - | N/A | ğŸ“‹ Not tested |

**Analysis:**
- purity_opt shows parity rather than expected 10%+ advantage
- Contract optimization benefits need compiler improvements

### Category C: Real-World

| Benchmark | Rust (ms) | BMB (ms) | Ratio | Status |
|-----------|-----------|----------|-------|--------|
| json_parse | 104 | 265 | **2.55x** | âŒ BMB 2.5x slower |
| sorting | - | - | N/A | ğŸ“‹ Not tested |

**Root Cause Analysis (json_parse):**
- String operations in BMB have significant overhead
- Recursive descent with `char_at()` creates allocation pressure
- Phase 34.4.1 (string views) would address this

---

## v0.34 Feature Verification

### f64 + Scientific Notation

```bmb
-- Test cases (all passing type check):
let pi = 3.14159265358979;      -- âœ… Standard notation
let avogadro = 6.022e23;        -- âœ… Positive exponent
let planck = 6.626e-34;         -- âœ… Negative exponent
let big = 1E10;                 -- âœ… Uppercase E
let small = 1.5e-5;             -- âœ… Mixed
```

### Missing for Full f64 Benchmarks

| Feature | Blocked Benchmarks | Status |
|---------|-------------------|--------|
| `sqrt` intrinsic | n_body | ğŸ“‹ Needs stdlib/math |
| i64â†’f64 conversion | mandelbrot_fp | ğŸ“‹ Needs type coercion |
| f64 array operations | spectral_norm_fp | ğŸ“‹ Needs dynamic arrays |

---

## Benchmark Gate Status

### Gate 1: Compute Parity âœ… PASSED (maintained)

- [x] fibonacci: BMB <= Rust âœ… (0.93x)
- [x] mandelbrot: BMB <= Rust âœ… (0.93x)
- [x] spectral_norm: BMB <= Rust âœ… (0.89x)

**Result: 3/3 valid benchmarks pass BMB >= Rust threshold**

### Gate 1.5: v0.34 Features âš ï¸ PARTIAL

- [x] Stage 3 Bootstrap 100% âœ… (7/7 tests)
- [x] f64 type + scientific notation âœ…
- [ ] n_body with f64 (blocked by sqrt)
- [ ] json_parse optimization (2.5x slower)

### Gate 2: Contract Advantage âš ï¸ PARTIAL

- [~] purity_opt: Expected 10%+ advantage, got parity
- [ ] bounds_check: Incomplete implementation

### Gate 4: Real-World Parity âŒ FAILED

- [x] json_parse: BMB should be <= Rust (currently 2.5x slower)

---

## Recommendations

### Immediate (Phase 34.4 completion)

1. **Add sqrt intrinsic** â†’ Unblocks n_body benchmark
2. **Add i64â†’f64 conversion** â†’ Enables mandelbrot_fp
3. **Profile json_parse** â†’ Identify string bottlenecks

### Short-term (Phase 34.5+)

1. String views/slices for json_parse optimization
2. Contract-based bounds check elimination
3. Complete stdlib/math/f64.bmb

### Long-term (v0.35+)

1. Phase 34.2: Dynamic Collections (Vec<T>, HashMap)
2. Full Benchmarks Game parity
3. Real-world workload suite

---

## Comparison with Previous Results

| Benchmark | Phase 33.5 | Phase 34.4 | Change |
|-----------|------------|------------|--------|
| fibonacci | 0.97x | 0.93x | âœ… Improved |
| mandelbrot | 0.93x | 0.93x | = Same |
| spectral_norm | 0.89x | 0.89x | = Same |
| purity_opt | 0.89x | 1.01x | âš ï¸ Regressed? |
| json_parse | 1.25x | 2.55x | âŒ Regressed |

**Notes:**
- purity_opt regression may be due to measurement variance
- json_parse regression needs investigation (possible build difference)

---

*Generated by BMB Benchmark Suite Phase 34.4*
*Stage 3 100% verified, f64 + Scientific Notation complete*
